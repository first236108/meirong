{include file="public/header" /}

<link href="/static/plugins/iCheck/custom.css" rel="stylesheet">
<link href="/static/plugins/blueimp/blueimp-gallery.min.css" rel="stylesheet">

<div class="wrapper wrapper-content animated fadeInRight tooltip-demo" style="background-color: #fff">
    <div class="ibox-title">
        {if condition="$type==1"}
        <h5 class="title-h5 red-bg">历史项目</h5>
        {else /}
        <h5 class="title-h5">服务项目</h5>
        {/if}
        <div class="ibox-tools">
            {if condition="$type==1"}
            <span class="btn btn-success btn-xs pull-left self-m-l" type="button" onclick="delProduct(0,' 恢复 ')" data-tip="tooltip" data-placement="top" title="" data-original-title="删除项目"><i class="fa fa-plus"></i>&nbsp;找回</span>
            {else /}
            <span class="btn btn-success btn-xs pull-left self-m-l" type="button" onclick="addmodal();" data-tip="tooltip" data-placement="top" title="" data-original-title="添加服务项目"><i class="fa fa-plus"></i>&nbsp;添加</span>
            <span class="btn btn-danger btn-xs pull-left self-m-l" type="button" onclick="delProduct(1,' 删除 ')" data-tip="tooltip" data-placement="top" title="" data-original-title="删除项目"><i class="fa fa-minus"></i>&nbsp;删除</span>
            <span class="btn btn-primary btn-xs pull-left self-m-l" type="button" onclick="recomment()" data-tip="tooltip" data-placement="top" title="" data-original-title="推荐置顶"><i class="fa fa-edit"></i>&nbsp;推荐</span>
            <span class="btn btn-default btn-xs pull-right self-m-l" type="button" onclick="location.href='/admin/item/index.html?type=1'" data-tip="tooltip" data-placement="top" title="" data-original-title="历史项目"><i class="fa fa-refresh"></i>&nbsp;历史</span>
            {/if}
        </div>
    </div>
    <div class="row" style="background-color: #fff">
        {volist name="list" id="vo"}
        <div class="col-md-3">
            <div class="ibox">
                <div class="ibox-content product-box lightBoxGallery">
                    <div class="product-imitation relative">
                        {if condition="$vo.is_recommend > 0"}
                        <img class="pull-left recommend absolue" src="/static/image/recommend2.png" alt="店长推荐">
                        {/if}
                        <a href="{$vo.origin_image}" title="{$vo.title}" data-gallery=""><img src="{$vo.origin_image}" alt=""></a>
                    </div>
                    <div class="product-desc">
                        <span class="product-price">
                            ￥{$vo.price}
                        </span>
                        <span class="product-sort form-inline">
                            <div class="form-group">
                                <label for="sort">排序:</label>
                                <input type="text" class="sort-input form-control" id="sort" value="{$vo.sort}" data-id="{$vo['item_id']}" placeholder="0">
                            </div>
                        </span>
                        <small class="text-muted">{$vo.cate_name}</small>
                        <a href="{:url('/index/item/detail',['item_id'=>$vo['item_id']])}" class="product-name"> {$vo.title}</a>
                        <div class="small m-t-xs break-line">{$vo.description,$vo.item_id}</div>
                        <div class="m-t text-righ">

                            <a onclick="changeOnSale('{$vo.item_id}',0,this)" class="btn btn-xs btn-outline btn-warning toggle-down {if $vo.on_sale==0}hidden{/if}">下架 <i class="fa fa-long-arrow-down"></i> </a>
                            <a onclick="changeOnSale('{$vo.item_id}',1,this)" class="btn btn-xs btn-outline btn-success toggle-up {if $vo.on_sale==1}hidden{/if}">上架 <i class="fa fa-long-arrow-up"></i> </a>

                            <a onclick="getEditData(this);" data-id="{$vo.item_id}" class="btn btn-xs btn-outline btn-primary m-l-lg">编辑修改 <i class="fa fa-long-arrow-right"></i> </a>
                            <span class="i-checks pull-right"><label> <input type="checkbox" value="{$vo['item_id']}" data-recommend="{$vo['is_recommend']}" class="del"> <i></i></label></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {/volist}
    </div>
    {$page}
</div>
<div id="blueimp-gallery" class="blueimp-gallery">
    <div class="slides"></div>
    <h3 class="title"></h3>
    <a class="prev">‹</a>
    <a class="next">›</a>
    <a class="close">×</a>
    <a class="play-pause"></a>
    <ol class="indicator"></ol>
</div>

<div class="modal inmodal" id="add-item-modal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">

    <div class="modal-dialog modal-lg">
        <div class="modal-content animated fadeIn">
            <div class="modal-header">
                <button type="button" class="close" onclick="$('#add-item-modal').modal('hide')"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                <h5 class="modal-title">添加 服务项目</h5>
            </div>
            <form id="addItemForm">

                <div class="modal-body">
                    <div class="tabs-container">
                        <ul class="nav nav-tabs">
                            <li class="active"><a data-toggle="tab" href="#tab-1"> 项目详情</a></li>
                            <li class=""><a data-toggle="tab" href="#tab-2"> 轮播图片</a></li>
                        </ul>
                        <div class="tab-content">
                            <div id="tab-1" class="tab-pane active">
                                <div class="panel-body">

                                    <fieldset class="form-horizontal">
                                        <div class="form-group"><label class="col-sm-2 control-label">项目名称:</label>
                                            <div class="col-sm-10"><input type="text" class="form-control" placeholder="Product name" name="title" value=""></div>
                                        </div>
                                        <div class="form-group"><label class="col-sm-2 control-label">售价:</label>
                                            <div class="col-sm-10">
                                                <div class="input-group">
                                                    <span class="input-group-addon">￥</span>
                                                    <input type="text" class="form-control" placeholder="160.00" name="price" value="">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group"><label class="col-sm-2 control-label">原价:</label>
                                            <div class="col-sm-10">
                                                <div class="input-group">
                                                    <span class="input-group-addon">￥</span>
                                                    <input type="text" class="form-control" placeholder="200.00" name="market_price" value="">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group"><label class="col-sm-2 control-label">数量:</label>
                                            <div class="col-sm-10"><input type="text" class="form-control" name="service_count" placeholder="1" value="1"></div>
                                        </div>
                                        <div class="form-group"><label class="col-sm-2 control-label">单位:</label>
                                            <div class="col-sm-10">
                                                <select class="form-control" name="unit">
                                                    <option value="次">次</option>
                                                    <option value="疗程">疗程</option>
                                                    <option value="瓶">瓶</option>
                                                    <option value="盒">盒</option>
                                                    <option value="张">张</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group"><label class="col-sm-2 control-label">赠送积分:</label>
                                            <div class="col-sm-10"><input type="text" class="form-control" name="give_integral" placeholder="0" value="0"></div>
                                        </div>
                                        <div class="form-group"><label class="col-sm-2 control-label">一级分类:</label>
                                            <div class="col-sm-10">
                                                <select class="form-control" name="cate_id">
                                                    <option value="0">请选择</option>
                                                    <option v-for="(vo1,index) in cate1" :value="index">{{vo1}}</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group"><label class="col-sm-2 control-label">二级分类:</label>
                                            <div class="col-sm-10">
                                                <select class="form-control" name="cate_id2">
                                                    <option value="0">请选择</option>
                                                    <option v-for="(vo2,keys) in cate2" :value="keys">{{vo2}}</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group"><label class="col-sm-2 control-label">简介描述:</label>
                                            <div class="col-sm-10">
                                                <textarea name="description" id="description" rows="3" class="form-control"></textarea>
                                            </div>
                                        </div>
                                        <div class="form-group"><label class="col-sm-2 control-label">项目详情:</label>
                                            <div class="col-sm-10">
                                                <script id="container" name="content" type="text/plain"></script>
                                            </div>
                                        </div>

                                    </fieldset>

                                </div>
                            </div>
                            <div id="tab-2" class="tab-pane">
                                <div class="panel-body">

                                    <div class="table-responsive">
                                        <table class="table table-bordered table-stripped">
                                            <thead>
                                            <tr>
                                                <th>
                                                    预览
                                                </th>
                                                <th>
                                                    排序
                                                </th>
                                                <th>
                                                    删除
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr>
                                                <td>
                                                    <a href="javascript:;" class="file">
                                                        <div class="fileList" id="addFileList1"><img src=""></div>
                                                        <input onchange="addHandleFiles(this,1)" type="file" accept="image/*"/>
                                                        <input type="hidden" name="image[]"/>
                                                    </a>
                                                </td>
                                                <td>
                                                    <input type="text" class="form-control" name="sort[]" value="1">
                                                </td>
                                                <td>
                                                    <button class="btn btn-white" type="button" onclick="delimage(1,1)"><i class="fa fa-trash"></i></button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <a href="javascript:;" class="file">
                                                        <div class="fileList" id="addFileList2"><img src=""></div>
                                                        <input onchange="addHandleFiles(this,2)" type="file" accept="image/*"/>
                                                        <input type="hidden" name="image[]"/>
                                                    </a>
                                                </td>
                                                <td>
                                                    <input type="text" class="form-control" name="sort[]" value="2">
                                                </td>
                                                <td>
                                                    <button class="btn btn-white" type="button" onclick="delimage(2,1)"><i class="fa fa-trash"></i></button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <a href="javascript:;" class="file">
                                                        <div class="fileList" id="addFileList3"><img src=""></div>
                                                        <input onchange="addHandleFiles(this,3)" type="file" accept="image/*"/>
                                                        <input type="hidden" name="image[]"/>
                                                    </a>
                                                </td>
                                                <td>
                                                    <input type="text" name="sort[]" class="form-control" value="3">
                                                </td>
                                                <td>
                                                    <button class="btn btn-white" type="button" onclick="delimage(3,1)"><i class="fa fa-trash"></i></button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <a href="javascript:;" class="file">
                                                        <div class="fileList" id="addFileList4"><img src=""></div>
                                                        <input onchange="addHandleFiles(this,4)" type="file" accept="image/*"/>
                                                        <input type="hidden" name="image[]"/>
                                                    </a>
                                                </td>
                                                <td>
                                                    <input type="text" name="sort[]" class="form-control" value="4">
                                                </td>
                                                <td>
                                                    <button class="btn btn-white" type="button" onclick="delimage(4,1)"><i class="fa fa-trash"></i></button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <a href="javascript:;" class="file">
                                                        <div class="fileList" id="addFileList5"><img src=""></div>
                                                        <input onchange="addHandleFiles(this,5)" type="file" accept="image/*"/>
                                                        <input type="hidden" name="image[]"/>
                                                    </a>
                                                </td>
                                                <td>
                                                    <input type="text" name="sort[]" class="form-control" value="5">
                                                </td>
                                                <td>
                                                    <button class="btn btn-white" type="button" onclick="delimage(5,1)"><i class="fa fa-trash"></i></button>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                        <input type="hidden" name="origin_image" id="add_origin_image">
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" onclick="$('#add-item-modal').modal('hide')">关 闭</button>
                    <button type="submit" class="btn btn-primary">保 存</button>
                </div>
            </form>
        </div>
    </div>

</div>

<div class="modal inmodal" id="edit-modal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">

    <div class="modal-dialog modal-lg">
        <div class="modal-content animated fadeIn">
            <div class="modal-header">
                <button type="button" class="close" onclick="$('#edit-modal').modal('hide')"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                <h5 class="modal-title">修改 服务项目</h5>
            </div>
            <form id="editItemForm">
                <div class="modal-body">
                    <input type="hidden" name="item_id" v-model="edit_item.item_id">
                    <div class="tabs-container">
                        <ul class="nav nav-tabs">
                            <li class="active"><a data-toggle="tab" href="#tab-3"> 项目详情</a></li>
                            <li class=""><a data-toggle="tab" href="#tab-4"> 轮播图片</a></li>
                        </ul>
                        <div class="tab-content">
                            <div id="tab-3" class="tab-pane active">
                                <div class="panel-body">

                                    <fieldset class="form-horizontal">
                                        <div class="form-group"><label class="col-sm-2 control-label">项目名称:</label>
                                            <div class="col-sm-10"><input type="text" class="form-control" placeholder="Product name" name="title" v-model="edit_item.title"></div>
                                        </div>
                                        <div class="form-group"><label class="col-sm-2 control-label">售价:</label>
                                            <div class="col-sm-10">
                                                <div class="input-group">
                                                    <span class="input-group-addon">￥</span>
                                                    <input type="text" class="form-control" placeholder="160.00" name="price" v-model="edit_item.price">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group"><label class="col-sm-2 control-label">原价:</label>
                                            <div class="col-sm-10">
                                                <div class="input-group">
                                                    <span class="input-group-addon">￥</span>
                                                    <input type="text" class="form-control" placeholder="200.00" name="market_price" v-model="edit_item.market_price">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group"><label class="col-sm-2 control-label">数量:</label>
                                            <div class="col-sm-10"><input type="text" class="form-control" name="service_count" placeholder="1" v-model="edit_item.service_count"></div>
                                        </div>
                                        <div class="form-group"><label class="col-sm-2 control-label">单位:</label>
                                            <div class="col-sm-10">
                                                <select class="form-control" name="unit" v-model="edit_item.unit">
                                                    <option value="次">次</option>
                                                    <option value="疗程">疗程</option>
                                                    <option value="瓶">瓶</option>
                                                    <option value="盒">盒</option>
                                                    <option value="张">张</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group"><label class="col-sm-2 control-label">赠送积分:</label>
                                            <div class="col-sm-10"><input type="text" class="form-control" name="give_integral" placeholder="0" v-model="edit_item.give_integral"></div>
                                        </div>
                                        <div class="form-group"><label class="col-sm-2 control-label">一级分类:</label>
                                            <div class="col-sm-10">
                                                <select class="form-control" name="cate_id" v-model="edit_item.cate_id">
                                                    <option value="0">请选择</option>
                                                    <option v-for="(vo1,index) in cate1" :value="index">{{vo1}}</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group"><label class="col-sm-2 control-label">二级分类:</label>
                                            <div class="col-sm-10">
                                                <select class="form-control" name="cate_id2" v-model="edit_item.cate_id2">
                                                    <option value="0">请选择</option>
                                                    <option v-for="(vo2,keys) in cate2" :value="keys">{{vo2}}</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group"><label class="col-sm-2 control-label">简介描述:</label>
                                            <div class="col-sm-10">
                                                <textarea name="description" rows="3" class="form-control" v-text="edit_item.description"></textarea>
                                            </div>
                                        </div>
                                        <div class="form-group"><label class="col-sm-2 control-label">项目详情:</label>
                                            <div class="col-sm-10">
                                                <script id="container1" name="content" type="text/plain"></script>
                                            </div>
                                        </div>

                                    </fieldset>

                                </div>
                            </div>
                            <div id="tab-4" class="tab-pane">
                                <div class="panel-body">

                                    <div class="table-responsive">
                                        <table class="table table-bordered table-stripped">
                                            <thead>
                                            <tr>
                                                <th>
                                                    预览
                                                </th>
                                                <th>
                                                    排序
                                                </th>
                                                <th>
                                                    删除
                                                </th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr v-if="edit_item.hasOwnProperty('img') && (edit_item.img.length >= 1)">
                                                <td>
                                                    <a href="javascript:;" class="file">
                                                        <div class="fileList" id="fileList1"><img :src="edit_item.origin_image"></div>
                                                        <input onchange="handleFiles(this,1)" type="file" accept="image/*"/>
                                                        <input type="hidden" name="image[]" v-model="edit_item.img[0].image"/>
                                                    </a>
                                                </td>
                                                <td>
                                                    <input type="text" class="form-control" name="sort[]" placeholder="1" v-model="edit_item.img[0].sort">
                                                </td>
                                                <td>
                                                    <button class="btn btn-white" type="button" onclick="delimage(1)"><i class="fa fa-trash"></i></button>
                                                </td>
                                            </tr>
                                            <tr v-else>
                                                <td>
                                                    <a href="javascript:;" class="file">
                                                        <div class="fileList" id="fileList1"><img :src="edit_item.origin_image"></div>
                                                        <input onchange="handleFiles(this,1)" type="file" accept="image/*"/>
                                                        <input type="hidden" name="image[]"/>
                                                    </a>
                                                </td>
                                                <td>
                                                    <input type="text" class="form-control" name="sort[]" value="1">
                                                </td>
                                                <td>
                                                    <button class="btn btn-white" type="button" onclick="delimage(1)"><i class="fa fa-trash"></i></button>
                                                </td>
                                            </tr>
                                            <tr v-if="edit_item.hasOwnProperty('img') && (edit_item.img.length >= 2)">
                                                <td>
                                                    <a href="javascript:;" class="file">
                                                        <div class="fileList" id="fileList2"><img :src="edit_item.img[1].image"></div>
                                                        <input onchange="handleFiles(this,2)" type="file" accept="image/*"/>
                                                        <input type="hidden" name="image[]" v-model="edit_item.img[1].image"/>
                                                    </a>
                                                </td>
                                                <td>
                                                    <input type="text" class="form-control" name="sort[]" placeholder="2" v-model="edit_item.img[1].sort">
                                                </td>
                                                <td>
                                                    <button class="btn btn-white" type="button" onclick="delimage(2)"><i class="fa fa-trash"></i></button>
                                                </td>
                                            </tr>
                                            <tr v-else>
                                                <td>
                                                    <a href="javascript:;" class="file">
                                                        <div class="fileList" id="fileList2"><img src=""></div>
                                                        <input onchange="handleFiles(this,2)" type="file" accept="image/*"/>
                                                        <input type="hidden" name="image[]"/>
                                                    </a>
                                                </td>
                                                <td>
                                                    <input type="text" class="form-control" name="sort[]" value="2">
                                                </td>
                                                <td>
                                                    <button class="btn btn-white" type="button" onclick="delimage(2)"><i class="fa fa-trash"></i></button>
                                                </td>
                                            </tr>
                                            <tr v-if="edit_item.hasOwnProperty('img') && (edit_item.img.length >= 3)">
                                                <td>
                                                    <a href="javascript:;" class="file">
                                                        <div class="fileList" id="fileList3"><img :src="edit_item.img[2].image"></div>
                                                        <input onchange="handleFiles(this,3)" type="file" accept="image/*"/>
                                                        <input type="hidden" name="image[]" v-model="edit_item.img[2].image"/>
                                                    </a>
                                                </td>
                                                <td>
                                                    <input type="text" name="sort[]" class="form-control" placeholder="3" v-model="edit_item.img[2].sort">
                                                </td>
                                                <td>
                                                    <button class="btn btn-white" type="button" onclick="delimage(3)"><i class="fa fa-trash"></i></button>
                                                </td>
                                            </tr>
                                            <tr v-else>
                                                <td>
                                                    <a href="javascript:;" class="file">
                                                        <div class="fileList" id="fileList3"><img src=""></div>
                                                        <input onchange="handleFiles(this,3)" type="file" accept="image/*"/>
                                                        <input type="hidden" name="image[]"/>
                                                    </a>
                                                </td>
                                                <td>
                                                    <input type="text" name="sort[]" class="form-control" value="3">
                                                </td>
                                                <td>
                                                    <button class="btn btn-white" type="button" onclick="delimage(3)"><i class="fa fa-trash"></i></button>
                                                </td>
                                            </tr>
                                            <tr v-if="edit_item.hasOwnProperty('img') && (edit_item.img.length >= 4)">
                                                <td>
                                                    <a href="javascript:;" class="file">
                                                        <div class="fileList" id="fileList4"><img ：src="edit_item.img[3].image"></div>
                                                        <input onchange="handleFiles(this,4)" type="file" accept="image/*"/>
                                                        <input type="hidden" name="image[]" v-model="edit_item.img[3].image"/>
                                                    </a>
                                                </td>
                                                <td>
                                                    <input type="text" name="sort[]" class="form-control" placeholder="4" v-model="edit_item.img[3].sort">
                                                </td>
                                                <td>
                                                    <button class="btn btn-white" type="button" onclick="delimage(4)"><i class="fa fa-trash"></i></button>
                                                </td>
                                            </tr>
                                            <tr v-else>
                                                <td>
                                                    <a href="javascript:;" class="file">
                                                        <div class="fileList" id="fileList4"><img src=""></div>
                                                        <input onchange="handleFiles(this,4)" type="file" accept="image/*"/>
                                                        <input type="hidden" name="image[]"/>
                                                    </a>
                                                </td>
                                                <td>
                                                    <input type="text" name="sort[]" class="form-control" value="4">
                                                </td>
                                                <td>
                                                    <button class="btn btn-white" type="button" onclick="delimage(4)"><i class="fa fa-trash"></i></button>
                                                </td>
                                            </tr>
                                            <tr v-if="edit_item.hasOwnProperty('img') && (edit_item.img.length >= 5)">
                                                <td>
                                                    <a href="javascript:;" class="file">
                                                        <div class="fileList" id="fileList5"><img :src="edit_item.img[4].image"></div>
                                                        <input onchange="handleFiles(this,5)" type="file" accept="image/*"/>
                                                        <input type="hidden" name="image[]" v-model="edit_item.img[4].image"/>
                                                    </a>
                                                </td>
                                                <td>
                                                    <input type="text" name="sort[]" class="form-control" placeholder="5" v-model="edit_item.img[4].sort">
                                                </td>
                                                <td>
                                                    <button class="btn btn-white" type="button" onclick="delimage(5)"><i class="fa fa-trash"></i></button>
                                                </td>
                                            </tr>
                                            <tr v-else>
                                                <td>
                                                    <a href="javascript:;" class="file">
                                                        <div class="fileList" id="fileList5"><img src=""></div>
                                                        <input onchange="handleFiles(this,5)" type="file" accept="image/*"/>
                                                        <input type="hidden" name="image[]"/>
                                                    </a>
                                                </td>
                                                <td>
                                                    <input type="text" name="sort[]" class="form-control" value="5">
                                                </td>
                                                <td>
                                                    <button class="btn btn-white" type="button" onclick="delimage(5)"><i class="fa fa-trash"></i></button>
                                                </td>
                                            </tr>
                                            </tbody>
                                        </table>
                                        <input type="hidden" name="origin_image" id="origin_image" v-model="edit_item.origin_image">
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-white" onclick="$('#edit-modal').modal('hide')">关 闭</button>
                    <button type="submit" class="btn btn-primary">保 存</button>
                </div>
            </form>
        </div>
    </div>

</div>

<script src="/static/js/vue.min.js"></script>
<script src="/static/plugins/iCheck/icheck.min.js"></script>
<script src="/static/plugins/ueditor/ueditor.config.js"></script>
<script src="/static/plugins/ueditor/ueditor.all.js"></script>
<script src="/static/plugins/layer/mobile/layer.js"></script>
<script src="/static/plugins/blueimp/jquery.blueimp-gallery.min.js"></script>
<script>
    var add,edit;
    $(document).ready(function () {
        $('.i-checks').iCheck({
            checkboxClass: 'icheckbox_square-green',
            radioClass: 'iradio_square-green'
        });
        $(".footer").hide();

        $("#addItemForm").validate({
            rules: {
                title: "required",
                price: {
                    required: true,
                    min: 0,
                    number: true
                },
                market_price: {
                    required: true,
                    min: 0,
                    number: true
                },
                give_integral: {
                    min: 0,
                    digits: true
                },
                cate_id: {required: true, min: 1},
                cate_id2: {required: true, min: 1},
                description: "required",
                origin_image: "required"
            },
            ignore: [],
            messages: {
                title: "服务项目的名称一定要填写哦",
                price: "服务价格必须填大于0的数字",
                market_price: "原价必须填大于0的数字",
                give_integral: "赠送积分只能是正整数呀",
                cate_id: "请选择一级分类",
                cate_id2: "请选择二级分类",
                description: "请填写项目简介",
                origin_image: "至少上传一张主图"
            },
            submitHandler: function (form) {
                var index = layer.open({type: 2, shadeClose: false});
                $.ajax({
                    type: 'POST',
                    url: '/admin/item/addEditItem',
                    data: $(form).serialize(),
                    success: function (data) {
                        layer.close(index);
                            layer.open({
                                content: '保存成功',
                                skin: 'msg',
                                time: 1.5,
                                end: function (elem) {
                                    location.reload();
                                }
                            });

                    },
                    error: function (e) {
                        err(e.responseText);
                    }
                });

            }
        });

        $("#editItemForm").validate({
            rules: {
                title: "required",
                price: {
                    required: true,
                    min: 0,
                    number: true
                },
                market_price: {
                    required: true,
                    min: 0,
                    number: true
                },
                give_integral: {
                    min: 0,
                    digits: true
                },
                cate_id: {required: true, min: 1},
                cate_id2: {required: true, min: 1},
                description: "required",
                origin_image: "required"
            },
            ignore: [],
            messages: {
                title: "服务项目的名称一定要填写哦",
                price: "服务价格必须填大于0的数字",
                market_price: "原价必须填大于0的数字",
                give_integral: "赠送积分只能是正整数呀",
                cate_id: "请选择一级分类",
                cate_id2: "请选择二级分类",
                description: "请填写项目简介",
                origin_image: "至少上传一张主图"
            },
            submitHandler: function (form) {
                var index = layer.open({type: 2, shadeClose: false});
                $.ajax({
                    type: 'POST',
                    url: '/admin/item/addEditItem',
                    data: $(form).serialize(),
                    success: function (data) {
                        layer.close(index);
                        layer.open({
                            content: '保存成功',
                            skin: 'msg',
                            time: 1.5,
                            end: function (elem) {
                                location.reload();
                            }
                        });

                    },
                    error: function (e) {
                        err(e.responseText);
                    }
                });

            }
        });
    });

    function addmodal(){
        $("#add-item-modal").modal('show');
        if (!add)
            add=UE.getEditor('container',{
                toolbars: [[
                    'fullscreen', 'source', '|', 'undo', 'redo', '|',
                    'bold', 'italic', 'underline', 'fontborder', 'strikethrough', 'superscript', 'subscript', 'removeformat', 'formatmatch', 'pasteplain', '|', 'forecolor', 'backcolor',
                    'insertorderedlist', 'insertunorderedlist', 'cleardoc', '|', 'lineheight', 'indent','horizontal','|', 'fontfamily', 'fontsize', '|',
                    'justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|', 'link', '|',
                    'simpleupload', 'insertimage', 'emotion', 'insertvideo', 'music', 'attachment', 'map', 'pagebreak', 'background', '|', 'inserttable', 'deletetable',
                    'insertparagraphbeforetable', 'insertrow', 'deleterow', 'insertcol', 'deletecol', 'mergecells', 'mergeright', 'mergedown', 'splittocells', 'splittorows', 'splittocols'
                ]]
            });
    }

    function getEditData(obj) {
        $("#edit-modal").modal('show');
        $.ajax({
            type: 'GET',
            url: '/admin/item/addEditItem?item_id='+$(obj).data('id'),
            success: function (data) {
                vm.edit_item = data;
                if(!edit)
                    edit=UE.getEditor('container1',{
                        toolbars: [[
                            'fullscreen', 'source', '|', 'undo', 'redo', '|',
                            'bold', 'italic', 'underline', 'fontborder', 'strikethrough', 'superscript', 'subscript', 'removeformat', 'formatmatch', 'pasteplain', '|', 'forecolor', 'backcolor',
                            'insertorderedlist', 'insertunorderedlist', 'cleardoc', '|', 'lineheight', 'indent','horizontal','|', 'fontfamily', 'fontsize', '|',
                            'justifyleft', 'justifycenter', 'justifyright', 'justifyjustify', '|', 'link', '|',
                            'simpleupload', 'insertimage', 'emotion', 'insertvideo', 'music', 'attachment', 'map', 'pagebreak', 'background', '|', 'inserttable', 'deletetable',
                            'insertparagraphbeforetable', 'insertrow', 'deleterow', 'insertcol', 'deletecol', 'mergecells', 'mergeright', 'mergedown', 'splittocells', 'splittorows', 'splittocols'
                        ]]
                    }).ready(function(){
                        if (vm.edit_item.detail)
                            this.setContent(vm.edit_item.detail);
                    });
                else
                    edit.setContent(vm.edit_item.detail);
            },
            error: function (e) {
                err();
            }
        });
    }

    function recomment() {
        var ids = '';
        var val = 1;
        $.each($('input:checkbox:checked'), function () {
            if (ids == '') {
                ids = $(this).val();
                val = $(this).data('recommend') ? 0 : 1;
            }
            else
                ids += ',' + $(this).val();
        });

        if (!ids) {
            toastr.warning('请勾选需要推荐的项目..');
            return false;
        }
        $.ajax({
            type: 'POST',
            url: '/admin/index/changeTableVal.html',
            data: {
                table: 'item',
                id_name: 'item_id',
                id_value: ids,
                field: 'is_recommend',
                value: val
            },
            success: function (data) {
                if (data) {
                    location.reload();
                } else {
                    toastr.error('操作失败');
                }
            },
            error: function (xhr, type) {
                err();
            }
        });

    }

    function delProduct(val, msg) {
        var ids = '';
        $.each($('input:checkbox:checked'), function () {
            if (ids == '')
                ids = $(this).val();
            else
                ids += ',' + $(this).val();
        });

        if (!ids) {
            toastr.warning('请勾选需要删除的项目..');
            return false;
        }

        swal({
            title: "确定要" + msg + "吗?",
            type: "warning",
            showCancelButton: true,
            confirmButtonColor: "#DD6B55",
            confirmButtonText: "确定",
            cancelButtonText: "取消",
            closeOnConfirm: false
        }, function () {
            $.ajax({
                type: 'POST',
                url: '/admin/index/changeTableVal.html',
                data: {
                    "table": 'item',
                    "id_name": 'item_id',
                    "id_value": ids,
                    "field": 'is_delete',
                    "value": val
                },
                success: function (data) {
                    if (data) {
                        location.reload();
                    } else {
                        toastr.error(data.msg);
                    }
                },
                error: function (xhr, type) {
                    err();
                }
            });
        });
    }

    function changeOnSale(id, val, obj) {
        classname = val == 1 ? '.toggle-down' : '.toggle-up';
        $.ajax({
            type: 'POST',
            url: '/admin/index/changeTableVal.html',
            data: {
                "table": 'item',
                "id_name": 'item_id',
                "id_value": id,
                "field": 'on_sale',
                "value": val
            },
            success: function (data) {
                if (data) {
                    $(obj).addClass('hidden').siblings(classname).removeClass('hidden');
                } else {
                    toastr.warning('操作失败');
                }
            },
            error: function (e) {
                toastr.err('网络错误，请稍后再试');
            }
        });
    }

    function init() {
        $.ajax({
            type: 'POST',
            url: '/admin/item/getCate.html',
            success: function (data) {
                if (data.succ == 0) {
                    vm.cate1 = data.data.cate1;
                    vm.cate2 = data.data.cate2;
                } else {
                    toastr.warning(data.msg);
                }
            },
            error: function (e) {
                toastr.error('网络异常，请稍后再试');
            }
        });
    }

    var vm = new Vue({
        el: "#wrapper",
        data: {
            init_data: {},
            edit_item: {},
            total: 1,
            p: 1,
            cate1: {},
            cate2: {},
            token: '',
            cdn: '',
            temp: '',
            origin_image: ''
        },
        created: function () {
            init();
        }
    });

    function getUpToken() {
        $.ajax({
            type: 'POST',
            url: "{:url('admin/ueditor/uploadToken')}",
            async:false,
            success: function (data) {
                vm.token = data.token;
                vm.cdn = data.cdn;
            },
            error: function (e) {
                toastr.error('获取图片上传token失败');
            }
        });
    }

    function handleFiles(obj, id) {
        if (!vm.token)
            getUpToken();
        var fileList = document.getElementById("fileList" + id);
        var files = obj.files;

        if (window.FileReader) {
            var reader = new FileReader();
            reader.readAsDataURL(files[0]);
            reader.onload = function (e) {
                putb64(vm.token, reader.result, 'call');
                fileList.firstElementChild.src = vm.temp;
                fileList.firstElementChild.height = '96';
                if (id == 1 || !vm.origin_image) {
                    document.getElementById('origin_image').value = vm.temp;
                    vm.origin_image = vm.temp;
                }
                obj.nextElementSibling.value = vm.temp;
            };
        } else {
            toastr.error('图片预览错误！');
        }
    }

    function addHandleFiles(obj, id) {
        if (!vm.token)
            getUpToken();
        var fileList = document.getElementById("addFileList" + id);
        var files = obj.files;

        if (window.FileReader) {
            var reader = new FileReader();
            reader.readAsDataURL(files[0]);
            reader.onload = function (e) {
                putb64(vm.token, reader.result, 'call');
                fileList.firstElementChild.src = vm.temp;
                fileList.firstElementChild.height = '96';
                if (id == 1 || !vm.origin_image) {
                    document.getElementById('add_origin_image').value = vm.temp;
                    vm.origin_image = vm.temp;
                }
                obj.nextElementSibling.value = vm.temp;
            };
        } else {
            toastr.error('图片预览错误！');
        }
    }

    function delimage(id,is_add) {
        var fileList='fileList';
        var imageid='origin_image';
        var form='#editItemForm';
        if (is_add){
            fileList='addFileList';
            imageid='add_origin_image';
            form='#addItemForm';
        }
        var fileList = document.getElementById(fileList + id);
        fileList.firstElementChild.src = '';
        fileList.nextElementSibling.nextElementSibling.value = '';

        //修改第一张图片为origin_image
        for (var i = 0; i < 5; i++) {
            var data = document.querySelectorAll(form+' input[name="image[]"]')[i].value;
            if (data)
                break;
        }

        document.getElementById(imageid).value = data;
    }

    function call(key) {
        vm.temp = vm.cdn + key;
    }

    var searltime;
    $(".sort-input").keyup(function (e) {
        clearTimeout(searltime);
        searltime = setTimeout("editsort(" + e.target.value + "," + e.target.getAttribute('data-id') + ")", 300);
    });

    function editsort(value, id) {
        $.ajax({
            type: 'POST',
            url: '/admin/index/changeTableVal.html',
            data: {
                "table": 'item',
                "id_name": 'item_id',
                "id_value": id,
                "field": 'sort',
                "value": value
            },
            success: function (data) {
                if (data)
                    layer.open({
                        content: '保存成功',
                        skin: 'msg',
                        time: 1
                    });
                else
                    err('排序值保存失败');
            },
            error: function (e) {
                err();
            }
        });
    }

</script>
{include file="public/footer" /}